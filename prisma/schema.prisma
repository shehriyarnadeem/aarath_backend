generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  FARMER
  BROKER
  BUYER
  RESELLER
  SELLER
  TRADER
  SHELLER_MILLER_PROCESSOR
  EXPORTER
  STOCK_INVESTOR
}

model User {
  id                 String    @id @default(uuid()) // Use DB-generated UUID for id
  email              String?   @unique // Make email optional
  name               String?
  role               UserRole?
  state              String?
  city               String?
  businessCategories String[] // Array of business categories
  profileCompleted   Boolean   @default(false)
  whatsapp           String? // WhatsApp number
  whatsappVerified   Boolean   @default(false)
  accountType        String? // 'personal' or 'company'
  // Personal fields
  personalName       String?
  personalLocation   String?
  personalProfilePic String?
  // Company fields
  companyName        String?
  businessAddress    String?
  businessRole       String?
  companyPicture     String?
  businessName       String?
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  products           Product[]

  @@map("users")
}

model Product {
  id              String   @id @default(uuid())
  serialNumber    Int      @unique
  userId          String // FK to User
  category        String
  title           String
  description     String
  quantity        Int
  unit            String
  images          String[] // Array of image URLs
  auction_live    Boolean  @default(false) // Toggle for auction vs marketplace
  // Marketplace fields
  price           Float?   // Price for marketplace listings
  priceType       String?  // "fixed" or "negotiable"
  // Auction fields
  startingBid     Float?   // Starting bid for auctions
  auctionDuration Int?     // Duration in hours
  currentBid      Float?   // Current highest bid
  auctionEndTime  DateTime? // When auction ends
  auctionStatus   String?  // "active", "ended", "cancelled"
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  user            User     @relation(fields: [userId], references: [id])
}

// Test counter model for WebSocket testing
model TestCounter {
  id         String   @id @default(uuid())
  counterId  String   @unique @map("counter_id")
  value      Int      @default(0)
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  @@map("test_counters")
}

// WebSocket connections model for real-time testing
model WebSocketConnection {
  id           String   @id @default(uuid())
  connectionId String   @unique @map("connection_id")
  counterId    String?  @map("counter_id")
  userId       String?  @map("user_id")
  connectedAt  DateTime @default(now()) @map("connected_at")
  expiresAt    DateTime @map("expires_at")

  @@index([counterId])
  @@index([expiresAt])
  @@index([userId])
  @@map("websocket_connections")
}